= form_tag(works_path, remote: true, method: :post, id: 'works_filters') do
  .by-card-header-v02
    .headline-2-v02= t(:sort_by)
    #sort-by
      .sort-by-desktop
        #anthology-select
          %select#sort_by{name: 'sort_by'}
            %option{value: 'alphabetical'}= t(:alphabetical)
            %optgroup{label: t(:dates)}
              %option{value: 'publication_date'}= t(:publication_date)
              %option{value: 'creation_date'}= t(:creation_date)
              %option{value: 'upload_date'}= t(:upload_date)
            %option{value: 'popularity'}= t(:popularity)
      .sort-by-mobile
        %p
          %input#RadioGroupSort_1{:name => "RadioGroupSort", :type => "radio", value: "alphabet"}/
          %label= t(:alphabetical)
          %br/
          %input#RadioGroupSort_2{:name => "RadioGroupSort", :type => "radio", value: "publish_date"}/
          %label= t(:publication_date)
          %br/
          %input#RadioGroupSort_3{:name => "RadioGroupSort", :type => "radio", value: "creation_date"}/
          %label= t(:creation_date)
          %br/
          %input#RadioGroupSort_4{:name => "RadioGroupSort", :type => "radio", value: "online_date"}/
          %label= t(:upload_date)
          %br/
          %input#RadioGroupSort_5{:name => "RadioGroupSort", :type => "radio", value: "popularity"}/
          %label= t(:popularity)
          %br/
  .by-card-content-v02#filters_panel
    .headline-2-v02= t(:filter_by)
    %span.reset.linkcolor.pointer= t(:reset_filter)
    .sort-type
      .vertical-expand
        .sort-type-headline= t(:name)
      .nested.active
        .row.nested-content
          .search-mobile-switch
            %button.search-mobile-option#opt_workname{:href => "#"}= t(:work_title)
            %button.search-mobile-option#opt_authorname{:href => "#"}= t(:author_name)
          %break
          %input.field-v02.field-without-label#search_input{:placeholder => t(:what_to_search_for), name: 'search_input', :type => "text", value: @search_input}/
          .multi-name-sort.pointer.notyet{style:'display:inline-block;'}
            %a.notyet{:href => "#"}= t(:multiselect)
          = hidden_field_tag(:search_type, id: 'search_type')
    .sort-type
      .vertical-expand
        .sort-type-headline= t(:genres)
      .nested.active
        .row.nested-content
          - get_genres.each_slice((get_genres.size/2.0).round) do |genres|
            .col-md-6.col-sm-12
              - genres.each do |g|
                - attrs = @genre_facet[g].nil? ? {disabled: 'disabled'} : {}
                - attrs.merge!({:name => "ckb_genres[]", :type => "checkbox", id: "genre_#{g}", value: g})
                - attrs.merge!({checked: 'checked'}) if @genres.present? && @genres.include?(g)
                %input{ attrs}/
                %label
                  %span.by-icon-v02>= glyph_for_genre(g)
                  = textify_genre(g)
                  %span= "(#{@genre_facet[g] || '0'})"
                %br/
    .sort-type
      .vertical-expand
        .sort-type-headline= t(:periods)
      .nested.active
        .row.nested-content
          - Expression.periods.invert.each_slice((Expression.periods.invert.size/2.0).round) do |periods|
            .col-md-6.col-sm-12
              - periods.each do |p|
                - attrs = @period_facet[p[0]].nil? ? {disabled: 'disabled'} : {}
                - attrs.merge!({:name => "ckb_periods[]", :type => "checkbox", id: "period_#{p[1]}", value: p[1]})
                - attrs.merge!({checked: 'checked'}) if @periods.present? && @periods.include?(p[1])
                %input{ attrs}/
                %label
                  = t(p[1])
                  %span= "(#{@period_facet[p[0]] || '0'})"
                %br/
    .sort-type
      .vertical-expand
        .sort-type-headline= t(:copyright_status)
      .nested.active
        .row.nested-content
          .col-md-6.col-sm-12
            - attrs = {name: "ckb_copyright[]", :type => "checkbox", id: 'copyright_0', value: 0}
            - attrs.merge!({checked: 'checked'}) if @copyright.present? && @copyright.include?(0)

            %input#CheckboxGroup3{attrs}/
            %label
              %span.by-icon-v02> m
              = t(:public_domain)
              %span= "(#{@copyright_facet[0] || '0'})"
            %br/
          .col-md-6.col-sm-12
            - attrs = {name: "ckb_copyright[]", :type => "checkbox", id: 'copyright_1', value: 1}
            - attrs.merge!({checked: 'checked'}) if @copyright.present? && @copyright.include?(1)
            %input#CheckboxGroup3_3{attrs}/
            %label
              %span.by-icon-v02> x
              = t(:by_permission)
              %span= "(#{@copyright_facet[1] || '0'})"
            %br/
    / .sort-type
    /   .vertical-expand
    /     .sort-type-headline מאפיינים
    /   .nested.active
    /     .row.nested-content
    /       .col-md-6.col-sm-12
    /         %input#CheckboxGroup4_1{:name => "CheckboxGroup4", :type => "checkbox", value: "sort_by_curatorial_content"}/
    /         %label
    /           תוכן אוצרותי
    /           %span (4)
    /         %br/
    /         %input#CheckboxGroup4_2{:name => "CheckboxGroup4", :type => "checkbox", value: "sort_by_recommendations"}/
    /         %label
    /           המלצות קוראים
    /           %span (12)
    /         %br/
    /         %input#CheckboxGroup4_3{:name => "CheckboxGroup4", :type => "checkbox", value: "sort_by_liked"}/
    /         %label
    /           יצירות שאהבתי
    /           %span (2)
    /       .col-md-6.col-sm-12
    /         %input#CheckboxGroup4_4{:disabled => "disabled", :name => "CheckboxGroup4", :type => "checkbox", value: "sort_by_active_bookmark"}/
    /         %label
    /           סימניה מופעלת
    /           %span (0)
    /         %br/
    /         %input#CheckboxGroup4_5{:name => "CheckboxGroup4", :type => "checkbox", value: "sort_by_no_properties"}/
    /         %label
    /           ללא מאפיינים
    /           %span (312)
    .sort-type
      .vertical-expand
        .sort-type-headline תאריך
      .nested.active
        .row.nested-content
          .search-mobile-switch
            %button.search-mobile-option{:href => "#"} הוצאה
            %button.search-mobile-option.active{:href => "#"} יצירה
            %button.search-mobile-option{:href => "#"} העלאה
          %break
          .dates-range
            .dates-graph-area
            .range-outside
              .range-inside
                .range-handle-right
                .range-handle-left
            %input.field-v02.field-without-label.range-date-field{:placeholder => "dd-mm-yyyy", name: "fromdate", :type => "text"}/
            .date-range-to עד
            %input.field-v02.field-without-label.range-date-field{:placeholder => "dd-mm-yyyy", :style => "float: left", name: "todate", :type => "text"}/
    .sort-type
      .vertical-expand
        .sort-type-headline= t(:orig_lang)
      .nested.active
        .row.nested-content{:style => "background-color: #d9cdd5"}
          %input#CheckboxGroup5_1{:name => "CheckboxGroup5", :type => "checkbox", value: "sort_by_translated"}/
          %label
            יצירות מתורגמות בלבד
            %span (963)
          %br/
        .row.nested-content
          .col-md-6.col-sm-12
            %input#CheckboxGroup5_2{:name => "CheckboxGroup5", :type => "checkbox", value: "sort_by_hebrew"}/
            %label
              עברית
              %span (8876)
            %br/
            %input#CheckboxGroup5_3{:name => "CheckboxGroup5", :type => "checkbox", value: "sort_by_russian"}/
            %label
              רוסית
              %span (503)
          .col-md-6.col-sm-12
            %input#CheckboxGroup5_4{:name => "CheckboxGroup5", :type => "checkbox", value: "sort_by_english"}/
            %label
              אנגלית
              %span (876)
            %br/
            %input#CheckboxGroup5_5{:name => "CheckboxGroup5", :type => "checkbox", value: "sort_by_german"}/
            %label
              גרמנית
              %span (442)
        .row.nested-content
          %a{:href => "#"} הצג עוד 18 שפות מקור
    = hidden_field_tag(:emit_filters, id: 'emit_filters')
:javascript
  $(document).ready(function() {
    $('#sort_by').val("#{@sort}");
    if("#{@search_type}" == 'authorname') {
      $('#opt_authorname').addClass('active');
      $('.multi-name-sort').show();
      $('#search_input').addClass('author-name-field');
      $('#search_type').val('authorname');
    } else {
      $('.multi-name-sort').hide();
      $('#opt_workname').addClass('active');
      $('#search_type').val('workname');
    }
    $('#opt_authorname').click(function(e){
      e.preventDefault();
      $('#opt_workname').removeClass('active');
      $('#opt_authorname').addClass('active');
      $('#search_type').val('authorname');
      $('.multi-name-sort').show();
      $('#search_input').addClass('author-name-field');
    });
    $('#opt_workname').click(function(e){
      e.preventDefault();
      $('#opt_workname').addClass('active');
      $('#opt_authorname').removeClass('active');
      $('#search_type').val('workname');
      $('.multi-name-sort').hide();
      $('#search_input').removeClass('author-name-field');
    });
    $('#works_filters').change(function(){
      $('#thelist').addClass('striped');
      $('#works_filters').submit();
    });
    $('.reset').click(function(){
      //$('#works_filters').not(':button, :submit, :reset, :hidden').val('').prop('checked', false).prop('selected', false);
      $('#works_filters').find(':input').each(function() {
        switch(this.type) {
            case 'password':
            case 'select-multiple':
            case 'select-one':
            case 'text':
            case 'textarea':
                $(this).val('');
                break;
            case 'checkbox':
            case 'radio':
                this.checked = false;
        }
      });
      $('#thelist').addClass('striped');
      $('#emit_filters').val('true');
      $('#works_filters').submit();
    });
  });
